<!DOCTYPE html>

<!--[if IE 8 ]><html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <title>小皮球公仔研究所</title>
    <meta name="author" content="themesflat.com">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description"
        content="Themesflat Ochaka - A modern and elegant Multipurpose eCommerce HTML Template, perfect for online stores selling rings, necklaces, watches, and other accessories. SEO-optimized, fast-loading, and fully customizable.">

    <!-- font -->
    <link rel="stylesheet" href="fonts/fonts.css">
    <link rel="stylesheet" href="icon/icomoon/style.css">
    <!-- css -->
    <link rel="stylesheet" href="https://sibforms.com/forms/end-form/build/sib-styles.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/swiper-bundle.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="images/logo/favicon.svg">
    <link rel="apple-touch-icon-precomposed" href="images/logo/favicon.svg">

    <!-- 預載影片 -->
    <link rel="preload" href="./assets/video/video.webm" as="video" type="video/webm">

    <style>
        /* --- 彈窗與遮罩 --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            /* 深色半透明背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            /* 背景模糊增加質感 */
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            /* 避免超出螢幕 */
        }

        .modal-overlay.show .modal-container {
            transform: scale(1);
        }

        .modal-header h3 {
            text-align: center;
            color: #b45309;
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
        }

        /* --- 水平捲動容器 --- */
        .prize-scroll-container {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0.5rem 2rem;
            /* 底部留空間給陰影 */
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            /* iOS 滑動優化 */

            /* 讓卡片置中對齊 */
            align-items: center;
        }

        /* 隱藏滾動條但保留功能 */
        .prize-scroll-container::-webkit-scrollbar {
            height: 6px;
        }

        .prize-scroll-container::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .prize-scroll-container::-webkit-scrollbar-track {
            background: transparent;
        }

        /* --- 翻牌卡片核心樣式 --- */
        .prize-card {
            flex: 0 0 160px;
            /* 固定寬度，不會被擠壓 */
            height: 220px;
            perspective: 1000px;
            /* 3D 透視點 */
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            /* 翻轉速度 */
            transform-style: preserve-3d;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }

        /* 當卡片加上 .flipped class 時翻轉 */
        .prize-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* 卡片背面 (未翻開)：類似紅包或卡牌背面 */
        .card-front {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid #fff;
        }

        /* 卡片正面 (獎品)：翻開後 */
        .card-back {
            background-color: white;
            transform: rotateY(180deg);
            /* 預先翻轉 180 度 */
            border: 1px solid #e5e7eb;
        }

        .card-back img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .card-back .prize-name {
            font-size: 0.9rem;
            color: #374151;
            padding: 0 10px;
            font-weight: 600;
        }

        /* --- 底部總結 --- */
        .modal-footer {
            display: block;
            margin-top: auto;
            text-align: center;
            border-top: 1px solid #f3f4f6;
            padding-top: 1rem;
        }

        .prize-summary-text {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 1rem;
            min-height: 1.5em;
            /* 預留高度避免跳動 */
        }
    </style>
</head>

<body>

    <div id="checkout-success" class="checkout-card">
        <div class="success-header">
            <div class="icon-circle">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                    stroke-linejoin="round" class="check-icon">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <h2 class="title">結帳完成</h2>
            <p class="subtitle">感謝您的購買，訂單處理中</p>
        </div>

        <button class="btn btn-secondary">回首頁</button>

        <div class="lottery-section">
            <div class="lottery-content">
                <span class="lottery-tag">BONUS</span>
                <h3>開始抽獎</h3>
                <label class="checkbox-wrapper">
                    <input type="checkbox" name="animation" id="animation">
                    <span class="checkmark"></span>
                    跳過抽獎動畫
                </label>
                <button onclick="checkout_an()" class="btn btn-primary btn-lottery">開始抽獎</button>
            </div>
        </div>
    </div>

    <div id="animation_video">
        <video src="./assets/video/video.webm" />
    </div>

    <div id="prize-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>恭喜抽中</h3>
            </div>

            <div class="prize-scroll-container" id="prize-list">
            </div>

            <div class="modal-footer">
                <p>總共 <span id="total-count">0</span> 項</p>
                <div id="prize-summary" class="prize-summary-text">
                </div>
                <button class="btn btn-primary" onclick="closeModal()">關閉</button>
            </div>
        </div>
    </div>

    <!-- Javascript -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap-select.min.js"></script>
    <script src="js/lazysize.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/count-down.js"></script>
    <script src="js/main.js"></script>

    <script src="js/sibforms.js" defer></script>
    <script>
        window.REQUIRED_CODE_ERROR_MESSAGE = 'Please choose a country code';
        window.LOCALE = 'en';
        window.EMAIL_INVALID_MESSAGE = window.SMS_INVALID_MESSAGE = "The information provided is invalid. Please review the field format and try again.";

        window.REQUIRED_ERROR_MESSAGE = "This field cannot be left blank. ";

        window.GENERIC_INVALID_MESSAGE = "The information provided is invalid. Please review the field format and try again.";

        window.translation = {
            common: {
                selectedList: '{quantity} list selected',
                selectedLists: '{quantity} lists selected'
            }
        };

        var AUTOHIDE = Boolean(0);
    </script>
    <script>
        // 模擬後端回傳的獎品資料
        const mockPrizes = [
            { name: "A賞", img: "http://placehold.jp/200x200.jpg" },
        ];

        function checkout_an() {
            const skipCheckbox = document.querySelector('#animation');
            const videoContainer = document.querySelector('#animation_video');
            const video = videoContainer.querySelector('video');

            if (!skipCheckbox.checked) {
                document.body.style.overflow = 'hidden';
                videoContainer.classList.add('active');
                video.currentTime = 0;
                video.play();
                video.onended = function () {
                    videoContainer.classList.remove('active');
                    document.body.style.overflow = '';
                    // 動畫結束後，執行結帳並開獎
                    checkout();
                };
            } else {
                checkout();
            }
        }

        function checkout() {
            console.log('結帳完成，準備開獎');

            // 1. 準備獎品 HTML
            renderPrizes(mockPrizes);

            // 2. 顯示彈窗
            const modal = document.getElementById('prize-modal');
            modal.classList.add('show');

            // 3. 執行自動翻牌特效 (延遲一點點讓彈窗先出來)
            setTimeout(() => {
                revealPrizes();
            }, 300);
        }

        // 渲染獎品列表
        function renderPrizes(prizes) {
            const container = document.getElementById('prize-list');
            const summary = document.getElementById('prize-summary');
            const totalCount = document.getElementById('total-count');

            container.innerHTML = ''; // 清空舊資料
            summary.innerText = '';   // 清空文字
            totalCount.innerText = prizes.length;

            prizes.forEach((prize, index) => {
                // 建立卡片 HTML 結構
                const cardHTML = `
            <div class="prize-card" id="card-${index}">
                <div class="card-inner">
                    <div class="card-front">
                        <span style="font-size:3rem">?</span>
                    </div>
                    <div class="card-back">
                        <img src="${prize.img}" alt="${prize.name}">
                        <div class="prize-name">${prize.name}</div>
                    </div>
                </div>
            </div>
        `;
                container.insertAdjacentHTML('beforeend', cardHTML);
            });
        }

        // 自動翻牌邏輯
        function revealPrizes() {
            const cards = document.querySelectorAll('.prize-card');
            const summaryText = [];
            const summaryEl = document.getElementById('prize-summary');

            cards.forEach((card, index) => {
                // 使用 setTimeout 讓卡片一張一張翻開 (每張間隔 200ms)
                setTimeout(() => {
                    card.classList.add('flipped');

                    // 更新下方文字
                    summaryText.push(mockPrizes[index].name);
                    summaryEl.innerText = summaryText.join('、');

                    // 如果是最後一張，或為了讓使用者好讀，自動捲動到當前翻開的卡片
                    card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

                }, index * 400); // 400ms 的間隔，製造節奏感
            });
        }

        function closeModal() {
            document.getElementById('prize-modal').classList.remove('show');
            // 可以在這裡加入重導向回首頁的邏輯
            // window.location.href = '/';
        }
    </script>
</body>

</html>